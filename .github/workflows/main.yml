name: set08103 group project
on: push

jobs:
  build:
    name: build test
    runs-on: ubuntu-20.04
    steps:
      - name: Checkout
        uses: actions/checkout@v2
        with:
          submodules: recursive
      - name: Set up JDK 11
        uses: actions/setup-java@v2
        with:
          java-version: '11'
          distribution: 'adopt'
      - name: Build with Maven
        run: mvn package
      - name: Run docker compose
        run: docker-compose up --abort-on-container-exit
UnitTests:
  name: Unit Tests
  runs-on: ubuntu-20.04
  steps:
    - name: Checkout
      uses: actions/checkout@v2
      with:
        submodules: recursive
    - name: Set up JDK 11
      uses: actions/setup-java@v2
      with:
        java-version: '11'
        distribution: 'adopt'
    - name: Unit Tests and CodeCov
      run: |
        docker build -t database ./db 
        docker run --name world -dp 33060:3306 database
        mvn -Dtest=com.napier.sem.AppTest test      
        docker stop world
        docker rm world 
        docker image rm database
    - name: CodeCov
      uses: codecov/codecov-action@v2
      with:
        # token: ${{ secrets.CODECOV_TOKEN }} # not required for public repos
        directory: ./target/site/jacoco
        flags: Unit Tests # optional
        verbose: true # optional (default = false)